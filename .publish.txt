on:
  release:
    types: [created]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4.0.0
        with:
          version: latest
          run_install: false
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: pnpm
          registry-url: 'https://registry.npmjs.org/'
      - run: pnpm install
      # run: pnpm test  if test runs ok then continue

  publish-npm:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - run: pnpm --filter grid-table build
      - run: pnpm publish --filter grid-table --access public
      - name: Create Release Pull Request or Publish
              id: changesets
              uses: changesets/action@v1
              with:
                publish: pnpm run ci:publish
              env:
                NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
                GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                NPM_TOKEN: ${{ secrets.NPM_TOKEN }}